generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                       String                    @id @default(cuid())
  email                    String                    @unique
  name                     String
  role                     UserRole                  @default(REP)
  phone                    String?
  status                   UserStatus                @default(ACTIVE)
  createdAt                DateTime                  @default(now()) @map("created_at")
  updatedAt                DateTime                  @updatedAt @map("updated_at")
  passwordHash             String?
  commissionRate           Float                     @default(0.5) @map("commission_rate")
  dailyLeadCap             Int                       @default(25)
  portalType               String                    @default("FULL")
  totalCloses              Int                       @default(0)
  lastSeenAt               DateTime?                 @map("last_seen_at")
  autoDialDelay            Int?                      @default(5) @map("auto_dial_delay")
  dialerMode               String?                   @default("single") @map("dialer_mode")
  voicemailUrl             String?                   @map("voicemail_url")
  agreedToTermsAt          DateTime?                 @map("agreed_to_terms_at")
  availableHours           Json?                     @map("available_hours")
  onboardingComplete       Boolean                   @default(false) @map("onboarding_complete")
  personalPhone            String?                   @map("personal_phone")
  assignedDialerPhone      String?                   @map("assigned_dialer_phone")
  stripeConnectId          String?                   @map("stripe_connect_id")
  stripeConnectStatus      String?                   @map("stripe_connect_status")
  timezone                 String?                   @default("America/New_York")
  twilioNumber1            String?                   @map("twilio_number_1")
  twilioNumber2            String?                   @map("twilio_number_2")
  vmRecordingUrl           String?                   @map("vm_recording_url")
  vmRecordingSid           String?                   @map("vm_recording_sid")
  autoDialEnabled          Boolean                   @default(false) @map("auto_dial_enabled")
  onboardingCompletedAt    DateTime?                 @map("onboarding_completed_at")
  outboundVmUrl            String?                   @map("outbound_vm_url")
  inboundVmUrl             String?                   @map("inbound_vm_url")
  outboundVmApproved       Boolean                   @default(false) @map("outbound_vm_approved")
  inboundVmApproved        Boolean                   @default(false) @map("inbound_vm_approved")
  activities               Activity[]
  callScorings             CallScoring[]             @relation("RepScoring")
  channelPerformance       ChannelPerformance[]
  clawdbotActivities       ClawdbotActivity[]
  clientsAsRep             Client[]                  @relation("ClientRep")
  closeEngineConversations CloseEngineConversation[] @relation("CloseEngineRep")
  commissions              Commission[]
  assignedLeads            Lead[]                    @relation("AssignedLeads")
  messages                 Message[]
  outboundEvents           OutboundEvent[]           @relation("RepOutboundEvents")
  repTasks                 RepTask[]                 @relation("RepTasks")
  dialerCallsAsRep         DialerCall[]              @relation("RepDialerCalls")
  dialerSessionsNew        DialerSessionNew[]        @relation("RepDialerSessionsNew")
  repUpsellTags            UpsellTag[]               @relation("RepUpsellTags")
  repCallbacks             CallbackSchedule[]        @relation("RepCallbacks")
  ownedLeads               Lead[]                    @relation("OwnedLeads")

  @@map("users")
}

model LeadFolder {
  id        String   @id @default(cuid())
  name      String
  color     String   @default("#3B82F6")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  leads     Lead[]

  @@map("lead_folders")
}

model Lead {
  id                     String                   @id @default(cuid())
  firstName              String                   @map("first_name")
  lastName               String?                  @map("last_name")
  email                  String?
  phone                  String
  companyName            String                   @map("company_name")
  city                   String?
  state                  String?
  sourceDetail           String?                  @map("source_detail")
  previewId              String?                  @unique @map("preview_id")
  previewUrl             String?                  @map("preview_url")
  createdAt              DateTime                 @default(now()) @map("created_at")
  updatedAt              DateTime                 @updatedAt @map("updated_at")
  assignedToId           String?                  @map("assigned_to_id")
  churnRiskScore         Int                      @default(0) @map("churn_risk_score")
  colorPrefs             Json?                    @map("color_prefs")
  enrichedAddress        String?                  @map("enriched_address")
  enrichedHours          Json?                    @map("enriched_hours")
  enrichedPhotos         Json?                    @map("enriched_photos")
  enrichedRating         Float?                   @map("enriched_rating")
  enrichedReviews        Int?                     @map("enriched_reviews")
  enrichedServices       Json?                    @map("enriched_services")
  hours                  Json?
  logo                   String?
  notes                  String?
  personalization        String?
  photos                 Json?
  previewExpiresAt       DateTime?                @map("preview_expires_at")
  priority               LeadPriority             @default(COLD)
  services               Json?
  status                 LeadStatus               @default(NEW)
  timezone               String?                  @default("America/New_York")
  website                String?
  source                 LeadSource
  callScript             String?                  @map("call_script")
  campaign               String?
  instantlyAddedDate     DateTime?                @map("instantly_added_date")
  instantlyCampaignId    String?                  @map("instantly_campaign_id")
  instantlyCurrentStep   Int                      @default(0) @map("instantly_current_step")
  instantlyStatus        String?                  @map("instantly_status")
  replySentiment         String?                  @map("reply_sentiment")
  industry               String                   @default("GENERAL_CONTRACTING")
  folderId               String?                  @map("folder_id")
  autonomyLevel          String                   @default("FULL_AUTO") @map("autonomy_level")
  closeEntryPoint        String?                  @map("close_entry_point")
  closeEngineTriggeredAt DateTime?                @map("close_engine_triggered_at")
  qualificationData      Json?                    @map("qualification_data")
  buildCompletedAt       DateTime?                @map("build_completed_at")
  buildDistributionMs    Int?                     @map("build_distribution_ms")
  buildEnrichmentMs      Int?                     @map("build_enrichment_ms")
  buildError             String?                  @map("build_error")
  buildPersonalizationMs Int?                     @map("build_personalization_ms")
  buildPreviewMs         Int?                     @map("build_preview_ms")
  buildScriptsMs         Int?                     @map("build_scripts_ms")
  buildStartedAt         DateTime?                @map("build_started_at")
  buildStep              String?                  @map("build_step")
  buildNotes             String?                  @map("build_notes")
  buildReadinessScore    Int?                     @map("build_readiness_score")
  siteHtml               String?                  @map("site_html")
  formUrl                String?                  @map("form_url")
  onboardingData         Json?                    @map("onboarding_data")
  onboardingStatus       String                   @default("NOT_STARTED") @map("onboarding_status")
  onboardingStep         Int                      @default(0) @map("onboarding_step")
  aiFollowup             Boolean                  @default(false) @map("ai_followup")
  handoffContext         Json?                    @map("handoff_context")
  secondaryPhone         String?                  @map("secondary_phone")
  smsPreferredNumber     String?                  @default("primary") @map("sms_preferred_number")
  dncAt                  DateTime?                @map("dnc_at")
  dncReason              String?                  @map("dnc_reason")
  dncAddedBy             String?                  @map("dnc_added_by")
  ownerRepId             String?                  @map("owner_rep_id")
  activities             Activity[]
  buildStatus            BuildStatus?
  clawdbotActivities     ClawdbotActivity[]
  client                 Client?
  closeConversation      CloseEngineConversation?
  conversationOutcomes   ConversationOutcome[]
  alternateContacts      LeadContact[]
  events                 LeadEvent[]
  assignedTo             User?                    @relation("AssignedLeads", fields: [assignedToId], references: [id])
  folder                 LeadFolder?              @relation(fields: [folderId], references: [id])
  messages               Message[]
  outboundEvents         OutboundEvent[]
  pendingActions         PendingAction[]
  repTasks               RepTask[]
  touchRecommendations   TouchRecommendation[]
  editRequests           EditRequest[]
  ownerRep               User?                    @relation("OwnedLeads", fields: [ownerRepId], references: [id])
  dialerCalls            DialerCall[]             @relation("DialerCalls")
  upsellTags             UpsellTag[]              @relation("LeadUpsellTags")
  callbackSchedules      CallbackSchedule[]       @relation("LeadCallbacks")
  siteEditVersion        Int                      @default(0) @map("site_edit_version")
  siteVersions           SiteVersion[]

  @@index([status])
  @@index([assignedToId])
  @@index([folderId])
  @@index([industry])
  @@index([phone])
  @@index([email])
  @@index([previewId])
  @@index([createdAt])
  @@index([instantlyCampaignId])
  @@index([instantlyStatus])
  @@index([instantlyCampaignId, instantlyStatus])
  @@index([instantlyCampaignId, replySentiment])
  @@index([previewUrl])
  @@index([buildStep])
  @@index([ownerRepId])
  @@index([dncAt])
  @@map("leads")
}

model LeadContact {
  id      String   @id @default(cuid())
  leadId  String   @map("lead_id")
  type    String
  value   String
  label   String
  addedBy String?  @map("added_by")
  addedAt DateTime @default(now()) @map("added_at")
  lead    Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([value])
  @@index([leadId])
  @@map("lead_contacts")
}

model LeadEvent {
  id        String    @id @default(cuid())
  leadId    String    @map("lead_id")
  eventType EventType @map("event_type")
  fromStage String?   @map("from_stage")
  toStage   String?   @map("to_stage")
  metadata  Json?
  actor     String?
  createdAt DateTime  @default(now()) @map("created_at")
  lead      Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([eventType])
  @@index([createdAt])
  @@map("lead_events")
}

model Client {
  id                   String             @id @default(cuid())
  leadId               String?            @unique @map("lead_id")
  companyName          String             @map("company_name")
  siteUrl              String?            @map("site_url")
  stagingUrl           String?            @map("staging_url")
  domainStatus         String?            @map("domain_status")
  hostingStatus        HostingStatus      @default(ACTIVE)
  stripeCustomerId     String?            @unique @map("stripe_customer_id")
  stripeSubscriptionId String?            @unique @map("stripe_subscription_id")
  monthlyRevenue       Float              @default(39) @map("monthly_revenue")
  upsells              Json?
  siteLiveDate         DateTime?          @map("site_live_date")
  lastInteraction      DateTime?          @map("last_interaction")
  nextTouchpoint       String?            @map("next_touchpoint")
  nextTouchpointDate   DateTime?          @map("next_touchpoint_date")
  churnRiskScore       Int                @default(0) @map("churn_risk_score")
  createdAt            DateTime           @default(now()) @map("created_at")
  updatedAt            DateTime           @updatedAt @map("updated_at")
  industry             String             @default("GENERAL_CONTRACTING")
  aiAutoRespond        Boolean            @default(true) @map("ai_auto_respond")
  channelPreference    String?            @map("channel_preference")
  churnedDate          DateTime?          @map("churned_date")
  closedDate           DateTime?          @map("closed_date")
  contactName          String?            @map("contact_name")
  email                String?
  healthScore          Int                @default(50) @map("health_score")
  location             String?
  notes                String?
  phone                String?
  plan                 String             @default("base")
  referralCode         String?            @unique @map("referral_code")
  repId                String?            @map("rep_id")
  statReportFrequency  String             @default("monthly") @map("stat_report_frequency")
  tags                 String[]           @default([])
  autonomyLevel        String             @default("FULL_AUTO") @map("autonomy_level")
  deletedAt            DateTime?          @map("deleted_at")
  customDomain         String?            @unique @map("custom_domain")
  vercelDomainId       String?            @map("vercel_domain_id")
  onboardingData       Json?              @map("onboarding_data")
  onboardingStep       Int                @default(0) @map("onboarding_step")
  enrichedData         Json?              @map("enriched_data")
  source               String?
  clawdbotActivities   ClawdbotActivity[]
  analytics            ClientAnalytics?
  lead                 Lead?              @relation(fields: [leadId], references: [id], onDelete: Cascade)
  rep                  User?              @relation("ClientRep", fields: [repId], references: [id])
  commissions          Commission[]
  editRequests         EditRequest[]
  messages             Message[]
  referralsGiven       Referral[]         @relation("ReferrerClient")
  revenue              Revenue[]
  sequenceProgress     SequenceProgress[]
  siteAnalytics        SiteAnalytic[]

  @@index([hostingStatus])
  @@index([churnRiskScore])
  @@index([healthScore])
  @@index([nextTouchpointDate])
  @@index([onboardingStep])
  @@map("clients")
}

model ClientAnalytics {
  id               String   @id @default(cuid())
  clientId         String   @unique @map("client_id")
  totalVisits      Int      @default(0) @map("total_visits")
  uniqueVisitors   Int      @default(0) @map("unique_visitors")
  totalForms       Int      @default(0) @map("total_forms")
  totalCalls       Int      @default(0) @map("total_calls")
  avgTimeOnSite    Float?   @map("avg_time_on_site")
  bounceRate       Float?   @map("bounce_rate")
  topTrafficSource String?  @map("top_traffic_source")
  avgResponseTime  Int?     @map("avg_response_time")
  missedCalls      Int      @default(0) @map("missed_calls")
  lastCalculated   DateTime @default(now()) @map("last_calculated")
  client           Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("client_analytics")
}

// Message ownership rules:
// - Pre-client messages (close engine): leadId is set, clientId is null
// - Post-client messages: clientId is set, leadId may also be set for cross-reference
// - Queries should filter by the appropriate ID based on context
model Message {
  id               String           @id @default(cuid())
  leadId           String?          @map("lead_id")
  clientId         String?          @map("client_id")
  direction        MessageDirection
  channel          MessageChannel   @default(SMS)
  recipient        String?
  content          String
  trigger          String?
  escalated        Boolean          @default(false)
  escalationReason String?          @map("escalation_reason")
  twilioSid        String?          @unique @map("twilio_sid")
  twilioStatus     String?          @map("twilio_status")
  createdAt        DateTime         @default(now()) @map("created_at")
  senderId         String?          @map("sender_id")
  senderName       String           @default("clawdbot") @map("sender_name")
  senderType       String           @default("SYSTEM") @map("sender_type")
  aiDelaySeconds   Int?             @map("ai_delay_seconds")
  aiGenerated      Boolean          @default(false) @map("ai_generated")
  conversationType String?          @map("conversation_type")
  emailSubject     String?          @map("email_subject")
  resendId         String?          @unique @map("resend_id")
  resendStatus     String?          @map("resend_status")
  aiDecisionLog    Json?            @map("ai_decision_log")
  mediaType        String?          @map("media_type")
  mediaUrls        Json?            @map("media_urls")
  reactionEmoji    String?          @map("reaction_emoji")
  reactionToId     String?          @map("reaction_to_id")
  reactionType     String?          @map("reaction_type")
  mediaTypes       Json?            @map("media_types")
  client           Client?          @relation(fields: [clientId], references: [id], onDelete: Cascade)
  lead             Lead?            @relation(fields: [leadId], references: [id], onDelete: Cascade)
  sentBy           User?            @relation(fields: [senderId], references: [id])

  @@index([leadId])
  @@index([clientId])
  @@index([createdAt])
  @@index([escalated])
  @@index([conversationType])
  @@map("messages")
}

model Activity {
  id              String           @id @default(cuid())
  leadId          String           @map("lead_id")
  repId           String           @map("rep_id")
  activityType    ActivityType     @map("activity_type")
  callDisposition CallDisposition? @map("call_disposition")
  durationSeconds Int?             @map("duration_seconds")
  notes           String?
  callbackDate    DateTime?        @map("callback_date")
  createdAt       DateTime         @default(now()) @map("created_at")
  lead            Lead             @relation(fields: [leadId], references: [id], onDelete: Cascade)
  rep             User             @relation(fields: [repId], references: [id])

  @@index([leadId])
  @@index([repId])
  @@index([createdAt])
  @@map("activities")
}

model RepActivity {
  id               String   @id @default(cuid())
  repId            String   @map("rep_id")
  date             DateTime @db.Date
  dials            Int      @default(0)
  conversations    Int      @default(0)
  previewLinksSent Int      @default(0) @map("preview_links_sent")
  closes           Int      @default(0)
  commissionEarned Float    @default(0) @map("commission_earned")
  notes            String?
  paymentLinksSent Int      @default(0) @map("payment_links_sent")
  paymentsClosed   Int      @default(0) @map("payments_closed")
  previewsOpened   Int      @default(0) @map("previews_opened")

  @@unique([repId, date])
  @@index([repId])
  @@index([date])
  @@map("rep_activity")
}

model Commission {
  id        String           @id @default(cuid())
  repId     String           @map("rep_id")
  clientId  String           @map("client_id")
  type      CommissionType
  amount    Float
  status    CommissionStatus @default(PENDING)
  period    String?
  notes     String?
  createdAt DateTime         @default(now()) @map("created_at")
  paidAt          DateTime?        @map("paid_at")
  wiseTransferId  String?          @map("wise_transfer_id")
  payoutBatchId   String?          @map("payout_batch_id")
  client          Client           @relation(fields: [clientId], references: [id], onDelete: Cascade)
  rep             User             @relation(fields: [repId], references: [id])

  @@index([repId])
  @@index([status])
  @@index([createdAt])
  @@map("commissions")
}

model Revenue {
  id              String        @id @default(cuid())
  clientId        String?       @map("client_id")
  type            RevenueType
  product         String?
  amount          Float
  recurring       Boolean       @default(false)
  stripePaymentId String?       @unique @map("stripe_payment_id")
  status          PaymentStatus @default(PENDING)
  createdAt       DateTime      @default(now()) @map("created_at")
  client          Client?       @relation(fields: [clientId], references: [id], onDelete: SetNull)

  @@index([clientId])
  @@index([type])
  @@index([createdAt])
  @@map("revenue")
}

model Notification {
  id        String           @id @default(cuid())
  title     String
  createdAt DateTime         @default(now()) @map("created_at")
  message   String
  metadata  Json?
  read      Boolean          @default(false)
  type      NotificationType

  @@index([read])
  @@index([createdAt])
  @@map("notifications")
}

model FailedWebhook {
  id         String   @id @default(cuid())
  source     String
  payload    Json
  error      String?
  retryCount Int      @default(0) @map("retry_count")
  createdAt  DateTime @default(now()) @map("created_at")

  @@index([source])
  @@index([retryCount])
  @@map("failed_webhooks")
}

model ApiCost {
  id        String   @id @default(cuid())
  service   String
  operation String
  cost      Float
  createdAt DateTime @default(now()) @map("created_at")

  @@index([service])
  @@index([createdAt])
  @@map("api_costs")
}

model Settings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("settings")
}

model ClawdbotActivity {
  id          String             @id @default(cuid())
  actionType  ClawdbotActionType
  description String
  leadId      String?            @map("lead_id")
  clientId    String?            @map("client_id")
  repId       String?            @map("rep_id")
  metadata    Json?
  tokenCost   Float?             @map("token_cost")
  createdAt   DateTime           @default(now()) @map("created_at")
  client      Client?            @relation(fields: [clientId], references: [id], onDelete: Cascade)
  lead        Lead?              @relation(fields: [leadId], references: [id], onDelete: Cascade)
  rep         User?              @relation(fields: [repId], references: [id])

  @@index([actionType])
  @@index([createdAt])
  @@index([leadId])
  @@index([clientId])
  @@map("clawdbot_activity")
}

model OutboundEvent {
  id             String              @id @default(cuid())
  leadId         String              @map("lead_id")
  channel        OutboundChannel
  status         OutboundEventStatus @default(SENT)
  messageId      String?             @map("message_id")
  content        String?
  subject        String?
  recipientEmail String?             @map("recipient_email")
  recipientPhone String?             @map("recipient_phone")
  sentAt         DateTime            @map("sent_at")
  openedAt       DateTime?           @map("opened_at")
  clickedAt      DateTime?           @map("clicked_at")
  repliedAt      DateTime?           @map("replied_at")
  metadata       Json?
  repId          String?             @map("rep_id")
  campaignId     String?             @map("campaign_id")
  createdAt      DateTime            @default(now()) @map("created_at")
  lead           Lead                @relation(fields: [leadId], references: [id], onDelete: Cascade)
  rep            User?               @relation("RepOutboundEvents", fields: [repId], references: [id])

  @@index([leadId])
  @@index([channel])
  @@index([status])
  @@index([createdAt])
  @@index([repId])
  @@index([campaignId])
  @@map("outbound_events")
}

model TouchRecommendation {
  id            String                 @id @default(cuid())
  leadId        String                 @map("lead_id")
  type          RecommendationType
  priority      RecommendationPriority @default(MEDIUM)
  reason        String
  suggestedAt   DateTime               @map("suggested_at")
  actionTakenAt DateTime?              @map("action_taken_at")
  actionType    String?                @map("action_type")
  metadata      Json?
  confidence    Float?
  createdAt     DateTime               @default(now()) @map("created_at")
  lead          Lead                   @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([type])
  @@index([priority])
  @@index([actionTakenAt])
  @@map("touch_recommendations")
}

model ChannelPerformance {
  id              String          @id @default(cuid())
  channel         OutboundChannel
  campaignId      String?         @map("campaign_id")
  repId           String?         @map("rep_id")
  period          String          @db.VarChar(10)
  totalSent       Int             @default(0) @map("total_sent")
  totalDelivered  Int             @default(0) @map("total_delivered")
  totalOpened     Int             @default(0) @map("total_opened")
  totalClicked    Int             @default(0) @map("total_clicked")
  totalReplied    Int             @default(0) @map("total_replied")
  totalBounced    Int             @default(0) @map("total_bounced")
  openRate        Float           @default(0) @map("open_rate")
  clickRate       Float           @default(0) @map("click_rate")
  replyRate       Float           @default(0) @map("reply_rate")
  conversionCount Int             @default(0) @map("conversion_count")
  revenue         Float           @default(0)
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  rep             User?           @relation(fields: [repId], references: [id])

  @@unique([channel, campaignId, repId, period])
  @@index([channel])
  @@index([repId])
  @@index([period])
  @@map("channel_performance")
}

model RepTask {
  id           String    @id @default(cuid())
  leadId       String
  repId        String?
  priority     String    @default("MEDIUM")
  taskType     String    @default("INITIAL_CALL")
  status       String    @default("PENDING")
  dueAt        DateTime  @default(now())
  completedAt  DateTime?
  outcome      String?
  notes        String?
  callDuration Int?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  lead         Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)
  rep          User?     @relation("RepTasks", fields: [repId], references: [id])

  @@map("rep_tasks")
}

model InstantlyDripLog {
  id                    String   @id @default(cuid())
  date                  DateTime @map("date")
  campaign              String?
  totalLimit            Int      @map("total_limit")
  usableSends           Int      @map("usable_sends")
  followupObligations   Int      @map("followup_obligations")
  availableForNew       Int      @map("available_for_new")
  leadsPushed           Int      @map("leads_pushed")
  leadsRemainingInQueue Int      @map("leads_remaining_in_queue")
  estDaysToClear        Int?     @map("est_days_to_clear")
  createdAt             DateTime @default(now()) @map("created_at")

  @@index([date])
  @@map("instantly_drip_log")
}

model InstantlySyncLog {
  id            String   @id @default(cuid())
  timestamp     DateTime @map("timestamp")
  fullReport    Json?    @map("full_report")
  alerts        Json?    @map("alerts")
  totalCapacity Int?     @map("total_capacity")
  totalPushed   Int?     @map("total_pushed")
  createdAt     DateTime @default(now()) @map("created_at")

  @@index([timestamp])
  @@map("instantly_sync_log")
}

model InstantlySyncChange {
  id            String   @id @default(cuid())
  syncTimestamp DateTime @map("sync_timestamp")
  changeType    String   @map("change_type")
  entity        String
  fieldChanged  String?  @map("field_changed")
  oldValue      String?  @map("old_value")
  newValue      String?  @map("new_value")
  impact        String?
  createdAt     DateTime @default(now()) @map("created_at")

  @@index([syncTimestamp])
  @@map("instantly_sync_changes")
}

model CallScoring {
  id                String   @id @default(cuid())
  repId             String   @map("rep_id")
  weekStart         DateTime @map("week_start") @db.Date
  connectToInterest Float    @default(0) @map("connect_to_interest")
  interestToClose   Float    @default(0) @map("interest_to_close")
  previewTextRate   Float    @default(0) @map("preview_text_rate")
  previewSendRate   Float    @default(0) @map("preview_send_rate")
  previewToOpenRate Float    @default(0) @map("preview_to_open_rate")
  openToCloseRate   Float    @default(0) @map("open_to_close_rate")
  avgDuration       Int      @default(0) @map("avg_duration")
  callbackShowRate  Float    @default(0) @map("callback_show_rate")
  dncRate           Float    @default(0) @map("dnc_rate")
  volumeScore       Int      @default(0) @map("volume_score")
  totalScore        Int      @default(0) @map("total_score")
  coachingNotes     String?  @map("coaching_notes")
  createdAt         DateTime @default(now()) @map("created_at")
  rep               User     @relation("RepScoring", fields: [repId], references: [id])

  @@unique([repId, weekStart])
  @@index([repId])
  @@index([weekStart])
  @@map("call_scoring")
}

model DoNotCall {
  id        String   @id @default(cuid())
  phone     String   @unique
  reason    String?
  addedBy   String?  @map("added_by")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("do_not_call")
}

model InstantlyDailyReport {
  id                  String    @id @default(cuid())
  reportDate          DateTime  @unique @map("report_date")
  syncTimestamp       DateTime  @map("sync_timestamp")
  fullReport          String    @map("full_report")
  smsReport           String?   @map("sms_report")
  changes             Json?     @map("changes")
  todayPlan           Json?     @map("today_plan")
  alerts              Json?     @map("alerts")
  totalCapacity       Int?      @map("total_capacity")
  totalPushing        Int?      @map("total_pushing")
  totalFollowups      Int?      @map("total_followups")
  totalSendsExpected  Int?      @map("total_sends_expected")
  capacityUtilization Float?    @map("capacity_utilization")
  smsSent             Boolean   @default(false) @map("sms_sent")
  smsSentAt           DateTime? @map("sms_sent_at")
  createdAt           DateTime  @default(now()) @map("created_at")

  @@index([reportDate])
  @@index([createdAt])
  @@map("instantly_daily_reports")
}

model EditRequest {
  id                 String    @id @default(cuid())
  clientId           String    @map("client_id")
  leadId             String?   @map("lead_id")
  requestText        String    @map("request_text")
  requestChannel     String    @default("sms") @map("request_channel")
  aiInterpretation   String?   @map("ai_interpretation")
  complexityTier     String    @default("medium") @map("complexity_tier")
  editFlowState      String    @default("pending") @map("edit_flow_state")
  preEditHtml        String?   @map("pre_edit_html")
  postEditHtml       String?   @map("post_edit_html")
  editSummary        String?   @map("edit_summary")
  stagingSnapshotUrl String?   @map("staging_snapshot_url")
  imageUrls          Json?     @map("image_urls")
  status             String    @default("new") @map("status")
  approvedBy         String?   @map("approved_by")
  approvedAt         DateTime? @map("approved_at")
  pushedLiveAt       DateTime? @map("pushed_live_at")
  createdAt          DateTime  @default(now()) @map("created_at")
  client             Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  lead               Lead?     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([leadId])
  @@index([status])
  @@index([editFlowState])
  @@index([createdAt])
  @@map("edit_requests")
}

model Sequence {
  id        String             @id @default(cuid())
  name      String             @unique
  steps     Json
  active    Boolean            @default(true)
  createdAt DateTime           @default(now()) @map("created_at")
  updatedAt DateTime           @updatedAt @map("updated_at")
  progress  SequenceProgress[]

  @@map("sequences")
}

model SequenceProgress {
  id          String    @id @default(cuid())
  clientId    String    @map("client_id")
  sequenceId  String    @map("sequence_id")
  currentStep Int       @default(1) @map("current_step")
  status      String    @default("active")
  startedAt   DateTime  @default(now()) @map("started_at")
  completedAt DateTime? @map("completed_at")
  nextStepAt  DateTime? @map("next_step_at")
  client      Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  sequence    Sequence  @relation(fields: [sequenceId], references: [id], onDelete: Cascade)

  @@unique([clientId, sequenceId])
  @@index([clientId])
  @@index([sequenceId])
  @@index([status])
  @@index([nextStepAt])
  @@map("sequence_progress")
}

model UpsellProduct {
  id                  String        @id @default(cuid())
  name                String
  price               Float
  recurring           Boolean       @default(true)
  stripeLink          String?       @map("stripe_link")
  active              Boolean       @default(true)
  createdAt           DateTime      @default(now()) @map("created_at")
  aiPitchInstructions String?       @map("ai_pitch_instructions")
  aiProductSummary    String?       @map("ai_product_summary")
  description         String?
  eligibleIndustries  String[]      @default([]) @map("eligible_industries")
  maxPitchesPerClient Int           @default(3) @map("max_pitches_per_client")
  minClientAgeDays    Int?          @map("min_client_age_days")
  pitchChannel        String        @default("sms") @map("pitch_channel")
  sortOrder           Int           @default(0) @map("sort_order")
  updatedAt           DateTime      @updatedAt @map("updated_at")
  annualPrice         Float?        @map("annual_price")
  isCore              Boolean       @default(false) @map("is_core")
  month1Price         Float?        @map("month1_price")
  pitchOneLiner       String?       @map("pitch_one_liner")
  previewBannerText   String?       @map("preview_banner_text")
  recurringPrice      Float?        @map("recurring_price")
  repCloseScript      String?       @map("rep_close_script")
  stripeLinkAnnual    String?       @map("stripe_link_annual")
  deletedAt           DateTime?     @map("deleted_at")
  repPitch            String?       @map("rep_pitch")
  pitches             UpsellPitch[]
  upsellTags          UpsellTag[]

  @@map("upsell_products")
}

model UpsellPitch {
  id           String        @id @default(cuid())
  clientId     String        @map("client_id")
  productId    String        @map("product_id")
  status       String        @default("pitched")
  pitchedAt    DateTime      @default(now()) @map("pitched_at")
  openedAt     DateTime?     @map("opened_at")
  clickedAt    DateTime?     @map("clicked_at")
  paidAt       DateTime?     @map("paid_at")
  pitchChannel String        @default("sms") @map("pitch_channel")
  sequenceDay  Int?          @map("sequence_day")
  product      UpsellProduct @relation(fields: [productId], references: [id])

  @@index([clientId])
  @@index([productId])
  @@index([status])
  @@map("upsell_pitches")
}

model Referral {
  id               String   @id @default(cuid())
  referrerClientId String   @map("referrer_client_id")
  referredName     String   @map("referred_name")
  referredPhone    String?  @map("referred_phone")
  referredEmail    String?  @map("referred_email")
  referredCompany  String?  @map("referred_company")
  leadId           String?  @map("lead_id")
  status           String   @default("pending")
  creditAmount     Float    @default(39) @map("credit_amount")
  creditApplied    Boolean  @default(false) @map("credit_applied")
  createdAt        DateTime @default(now()) @map("created_at")
  referrerClient   Client   @relation("ReferrerClient", fields: [referrerClientId], references: [id], onDelete: Cascade)

  @@index([referrerClientId])
  @@index([status])
  @@map("referrals")
}

model SiteAnalytic {
  id             String   @id @default(cuid())
  clientId       String   @map("client_id")
  eventType      String   @map("event_type")
  page           String?
  device         String?
  referralSource String?  @map("referral_source")
  sessionId      String?  @map("session_id")
  createdAt      DateTime @default(now()) @map("created_at")
  client         Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([eventType])
  @@index([createdAt])
  @@map("site_analytics")
}

model StripeSyncLog {
  id              String   @id @default(cuid())
  syncType        String   @map("sync_type")
  mismatchesFound Int      @default(0) @map("mismatches_found")
  correctionsMade Json?    @map("corrections_made")
  createdAt       DateTime @default(now()) @map("created_at")

  @@map("stripe_sync_log")
}

model AiPerformanceLog {
  id             String   @id @default(cuid())
  conversationId String?  @map("conversation_id")
  messageId      String?  @map("message_id")
  aiResponseText String?  @map("ai_response_text")
  clientReaction String?  @map("client_reaction")
  outcome        String?
  editApproved   Boolean? @map("edit_approved")
  promptVersion  Int      @default(1) @map("prompt_version")
  createdAt      DateTime @default(now()) @map("created_at")

  @@index([promptVersion])
  @@index([outcome])
  @@index([createdAt])
  @@map("ai_performance_log")
}

model PromptVersion {
  id          String   @id @default(cuid())
  version     Int      @unique
  content     String
  changeNotes String?  @map("change_notes")
  performance Json?
  active      Boolean  @default(false)
  createdAt   DateTime @default(now()) @map("created_at")

  @@map("prompt_versions")
}

model ChannelDecision {
  id            String   @id @default(cuid())
  clientId      String?  @map("client_id")
  leadId        String?  @map("lead_id")
  trigger       String
  chosenChannel String   @map("chosen_channel")
  reason        String
  ruleApplied   String?  @map("rule_applied")
  aiConfidence  Float?   @map("ai_confidence")
  signals       Json?
  latencyMs     Int?     @map("latency_ms")
  messageSent   Boolean  @default(false) @map("message_sent")
  createdAt     DateTime @default(now()) @map("created_at")

  @@index([clientId])
  @@index([leadId])
  @@index([chosenChannel])
  @@index([createdAt])
  @@map("channel_decisions")
}

model CloseEngineConversation {
  id                String          @id @default(cuid())
  leadId            String          @unique @map("lead_id")
  repId             String?         @map("rep_id")
  entryPoint        String          @map("entry_point")
  stage             String          @default("INITIATED")
  autonomyLevel     String          @default("FULL_AUTO") @map("autonomy_level")
  questionsAsked    Json?           @map("questions_asked")
  collectedData     Json?           @map("collected_data")
  editRounds        Int             @default(0) @map("edit_rounds")
  paymentLinkUrl    String?         @map("payment_link_url")
  paymentLinkSentAt DateTime?       @map("payment_link_sent_at")
  stalledAt         DateTime?       @map("stalled_at")
  completedAt       DateTime?       @map("completed_at")
  closedLostAt      DateTime?       @map("closed_lost_at")
  closedLostReason  String?         @map("closed_lost_reason")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")
  lead              Lead            @relation(fields: [leadId], references: [id], onDelete: Cascade)
  rep               User?           @relation("CloseEngineRep", fields: [repId], references: [id])
  pendingActions    PendingAction[]

  @@index([stage])
  @@index([entryPoint])
  @@index([createdAt])
  @@map("close_engine_conversations")
}

model PendingAction {
  id             String                  @id @default(cuid())
  conversationId String                  @map("conversation_id")
  leadId         String                  @map("lead_id")
  type           String
  draftMessage   String                  @map("draft_message")
  metadata       Json?
  status         String                  @default("PENDING")
  approvedBy     String?                 @map("approved_by")
  approvedAt     DateTime?               @map("approved_at")
  expiresAt      DateTime?               @map("expires_at")
  createdAt      DateTime                @default(now()) @map("created_at")
  conversation   CloseEngineConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  lead           Lead                    @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([leadId])
  @@index([conversationId])
  @@map("pending_actions")
}

model Approval {
  id           String    @id @default(cuid())
  gate         String
  title        String
  description  String
  draftContent String?   @map("draft_content")
  leadId       String?   @map("lead_id")
  clientId     String?   @map("client_id")
  requestedBy  String    @default("system") @map("requested_by")
  status       String    @default("PENDING")
  priority     String    @default("NORMAL")
  metadata     Json?
  resolvedBy   String?   @map("resolved_by")
  resolvedAt   DateTime? @map("resolved_at")
  expiresAt    DateTime? @map("expires_at")
  createdAt    DateTime  @default(now()) @map("created_at")

  @@index([status])
  @@index([gate])
  @@index([createdAt])
  @@index([leadId])
  @@index([clientId])
  @@map("approvals")
}

model BuildStatus {
  id                   String    @id @default(cuid())
  leadId               String    @unique @map("lead_id")
  servicesCollected    Boolean   @default(false) @map("services_collected")
  servicesData         Json?     @map("services_data")
  hoursCollected       Boolean   @default(false) @map("hours_collected")
  hoursData            String?   @map("hours_data")
  logoCollected        Boolean   @default(false) @map("logo_collected")
  logoUrl              String?   @map("logo_url")
  photosCollected      Boolean   @default(false) @map("photos_collected")
  photosData           Json?     @map("photos_data")
  companyNameConfirmed Boolean   @default(false) @map("company_name_confirmed")
  companyNameOverride  String?   @map("company_name_override")
  colorPrefsCollected  Boolean   @default(false) @map("color_prefs_collected")
  status               String    @default("collecting")
  autoPush             Boolean   @default(false) @map("auto_push")
  lastPushedAt         DateTime? @map("last_pushed_at")
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")
  lead                 Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@map("build_status")
}

model ConversationOutcome {
  id                  String   @id @default(cuid())
  leadId              String   @map("lead_id")
  finalStage          String   @map("final_stage")
  totalMessages       Int      @map("total_messages")
  messagesPerStage    Json?    @map("messages_per_stage")
  timeToConvert       Int?     @map("time_to_convert")
  stalledAtStage      String?  @map("stalled_at_stage")
  stalledAfterMessage String?  @map("stalled_after_message")
  lastLeadMessage     String?  @map("last_lead_message")
  effectivePatterns   Json?    @map("effective_patterns")
  ineffectivePatterns Json?    @map("ineffective_patterns")
  industry            String
  objectionType       String?  @map("objection_type")
  objectionResolved   String?  @map("objection_resolved")
  reactivated         Boolean  @default(false)
  reactivationTrigger String?  @map("reactivation_trigger")
  createdAt           DateTime @default(now()) @map("created_at")
  lead                Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([industry])
  @@index([finalStage])
  @@index([createdAt])
  @@index([leadId])
  @@map("conversation_outcomes")
}

enum UserRole {
  CHILLBOT
  ADMIN
  REP
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum LeadStatus {
  NEW
  HOT_LEAD
  QUALIFIED
  INFO_COLLECTED
  BUILDING
  QA
  CLIENT_REVIEW
  APPROVED
  PAID
  CLOSED_LOST
  DO_NOT_CONTACT
}

enum LeadSource {
  COLD_EMAIL
  COLD_CALL
  META_AD
  REFERRAL
  PARTNER
  ORGANIC
  CSV_IMPORT
  MANUAL
  FORM
}

enum LeadPriority {
  HOT
  WARM
  NORMAL
  COLD
}

enum EventType {
  STAGE_CHANGE
  EMAIL_SENT
  EMAIL_OPENED
  EMAIL_REPLIED
  PREVIEW_VIEWED
  PREVIEW_CTA_CLICKED
  PREVIEW_CALL_CLICKED
  PREVIEW_RETURN_VISIT
  CALL_MADE
  TEXT_SENT
  TEXT_RECEIVED
  INFO_RECEIVED
  PAYMENT_RECEIVED
  SITE_LIVE
  ESCALATED
  CLOSE_ENGINE_TRIGGERED
  CLOSE_ENGINE_STAGE_CHANGE
  POSITIVE_FEEDBACK
  CLOSE_ENGINE_COMPLETED
  SMS_FALLBACK_EMAIL
  CALL_ATTEMPTED
  CALL_CONNECTED
  CALL_ENDED
  PREVIEW_SENT_SMS
  PREVIEW_SENT_EMAIL
  UPSELL_PITCHED
  UPSELL_LINK_SENT
  PAYMENT_LINK_SENT_REP
  CALLBACK_SCHEDULED
  AI_HANDOFF
  CUSTOM_REQUEST
  WANTS_CHANGES
  ALTERNATE_CONTACT_ADDED
  SKIPPED
  REASSIGNED
  REP_NOTE
  AUTO_SMS_SENT
  CALL_SUMMARY
}

enum HostingStatus {
  ACTIVE
  CANCELLED
  FAILED_PAYMENT
  GRACE_PERIOD
  DEACTIVATED
}

enum MessageDirection {
  OUTBOUND
  INBOUND
}

enum MessageChannel {
  SMS
  EMAIL
}

enum ActivityType {
  CALL
  VOICEMAIL
  EMAIL
  NOTE
  STATUS_CHANGE
  PREVIEW_SENT
}

enum CallDisposition {
  CONNECTED
  NO_ANSWER
  VOICEMAIL
  WRONG_NUMBER
  GATEKEEPER
  NOT_INTERESTED
  CALLBACK
  INTERESTED
}

enum CommissionType {
  SITE_BUILD
  MONTHLY_RESIDUAL
  BONUS
}

enum CommissionStatus {
  PENDING
  APPROVED
  PAID
  REJECTED
}

enum RevenueType {
  SITE_BUILD
  HOSTING_MONTHLY
  HOSTING_ANNUAL
  UPSELL
  ADD_ON
}

enum PaymentStatus {
  PAID
  FAILED
  REFUNDED
  PENDING
}

enum NotificationType {
  HOT_LEAD
  PAYMENT_RECEIVED
  PAYMENT_FAILED
  EMAIL_REPLY
  CLIENT_TEXT
  ESCALATION
  DAILY_AUDIT
  SITE_QA_READY
  CLOSE_ENGINE
  SYSTEM_ALERT       // BUG P.3: Used by Clawdbot notifications route
}

enum ClawdbotActionType {
  TEXT_SENT
  TEXT_RECEIVED
  ALERT
  HEARTBEAT
  IMPORT
  ENRICHMENT
  PREVIEW_GENERATED
  NURTURE_ACTION
  URGENCY_ACTION
  UPSELL_PITCH
  REFERRAL_ASK
  ANNUAL_PITCH
  ESCALATION
  SCORE_UPDATE
  QUEUE_UPDATE
  PAYMENT_RECEIVED
  LESSON_SAVED
  PATTERN_SAVED
  ERROR
  CHILLBOT_DIAGNOSTIC
  CHILLBOT_REPORT
  CHILLBOT_ALERT
  NIGHTLY_DIGEST
  MORNING_REPORT
  WEEKLY_REPORT
  PERSONALIZATION
}

enum OutboundChannel {
  EMAIL
  SMS
  PHONE
  LINKEDIN
  INSTANTLY
}

enum OutboundEventStatus {
  SENT
  DELIVERED
  OPENED
  CLICKED
  REPLIED
  BOUNCED
  UNSUBSCRIBED
  FAILED
}

enum RecommendationPriority {
  URGENT
  HIGH
  MEDIUM
  LOW
}

enum RecommendationType {
  SEND_EMAIL
  SEND_SMS
  PHONE_CALL
  LINKEDIN_MESSAGE
  FOLLOW_UP
  URGENCY_PITCH
  ANNUAL_PITCH
  UPSELL
  NURTURE
  RE_ENGAGEMENT
  ESCALATION
}

// ==========================================
// Power Dialer V2 Models
// ==========================================

enum DialerCallStatus {
  INITIATED
  RINGING
  CONNECTED
  COMPLETED
  FAILED
  NO_ANSWER
  BUSY
  VOICEMAIL
}

enum CallDirection {
  OUTBOUND
  INBOUND
}

enum CallbackStatus {
  PENDING
  COMPLETED
  MISSED
  CANCELLED
}

model DialerCall {
  id                      String           @id @default(cuid())
  leadId                  String           @map("lead_id")
  repId                   String           @map("rep_id")
  sessionId               String?          @map("session_id")
  twilioCallSid           String?          @unique @map("twilio_call_sid")
  status                  DialerCallStatus @default(INITIATED)
  direction               CallDirection    @default(OUTBOUND)
  startedAt               DateTime         @default(now()) @map("started_at")
  connectedAt             DateTime?        @map("connected_at")
  endedAt                 DateTime?        @map("ended_at")
  duration                Int?
  recordingUrl            String?          @map("recording_url")
  recordingSid            String?          @map("recording_sid")
  dispositionResult       String?          @map("disposition_result")
  dispositionPath         Json?            @map("disposition_path")
  wasRecommended          Boolean          @default(false) @map("was_recommended")
  previewSentDuringCall   Boolean          @default(false) @map("preview_sent_during_call")
  previewSentChannel      String?          @map("preview_sent_channel")
  previewOpenedDuringCall Boolean          @default(false) @map("preview_opened_during_call")
  ctaClickedDuringCall    Boolean          @default(false) @map("cta_clicked_during_call")
  vmDropped               Boolean          @default(false) @map("vm_dropped")
  vmDroppedAt             DateTime?        @map("vm_dropped_at")
  vmDropSid               String?          @map("vm_drop_sid")
  notes                   String?
  phoneNumberUsed         String?          @map("phone_number_used")
  amdResult               String?          @map("amd_result")

  lead                    Lead             @relation("DialerCalls", fields: [leadId], references: [id], onDelete: Cascade)
  rep                     User             @relation("RepDialerCalls", fields: [repId], references: [id])
  session                 DialerSessionNew? @relation(fields: [sessionId], references: [id])
  upsellTags              UpsellTag[]
  callbackSchedules       CallbackSchedule[]

  @@index([repId, startedAt])
  @@index([leadId])
  @@index([sessionId])
  @@map("dialer_calls")
}

model DialerSessionNew {
  id                 String       @id @default(cuid())
  repId              String       @map("rep_id")
  startedAt          DateTime     @default(now()) @map("started_at")
  endedAt            DateTime?    @map("ended_at")
  isActive           Boolean      @default(true) @map("is_active")
  autoDialEnabled    Boolean      @default(false) @map("auto_dial_enabled")
  totalCalls         Int          @default(0) @map("total_calls")
  connectedCalls     Int          @default(0) @map("connected_calls")
  voicemails         Int          @default(0)
  noAnswers          Int          @default(0) @map("no_answers")
  avgCallDuration    Float        @default(0) @map("avg_call_duration")
  previewsSent       Int          @default(0) @map("previews_sent")
  previewsOpened     Int          @default(0) @map("previews_opened")
  ctaClicks          Int          @default(0) @map("cta_clicks")
  callbacksScheduled Int          @default(0) @map("callbacks_scheduled")
  interestedCount    Int          @default(0) @map("interested_count")
  notInterestedCount Int          @default(0) @map("not_interested_count")

  rep                User         @relation("RepDialerSessionsNew", fields: [repId], references: [id])
  calls              DialerCall[]

  @@index([repId, isActive])
  @@map("dialer_sessions_new")
}

model UpsellTag {
  id           String        @id @default(cuid())
  leadId       String        @map("lead_id")
  productId    String        @map("product_id")
  addedByRepId String        @map("added_by_rep_id")
  callId       String?       @map("call_id")
  productName  String        @map("product_name")
  productPrice Float         @map("product_price")
  taggedAt     DateTime      @default(now()) @map("tagged_at")
  removedAt    DateTime?     @map("removed_at")

  lead         Lead          @relation("LeadUpsellTags", fields: [leadId], references: [id], onDelete: Cascade)
  product      UpsellProduct @relation(fields: [productId], references: [id])
  rep          User          @relation("RepUpsellTags", fields: [addedByRepId], references: [id])
  call         DialerCall?   @relation(fields: [callId], references: [id])

  @@index([leadId])
  @@index([productId])
  @@map("upsell_tags")
}

model CallbackSchedule {
  id                String         @id @default(cuid())
  leadId            String         @map("lead_id")
  repId             String         @map("rep_id")
  scheduledAt       DateTime       @map("scheduled_at")
  completedAt       DateTime?      @map("completed_at")
  status            CallbackStatus @default(PENDING)
  notes             String?
  createdFromCallId String?        @map("created_from_call_id")
  createdAt         DateTime       @default(now()) @map("created_at")

  lead              Lead           @relation("LeadCallbacks", fields: [leadId], references: [id], onDelete: Cascade)
  rep               User           @relation("RepCallbacks", fields: [repId], references: [id])
  call              DialerCall?    @relation(fields: [createdFromCallId], references: [id])

  @@index([repId, status, scheduledAt])
  @@map("callback_schedules")
}

model SiteVersion {
  id        String   @id @default(cuid())
  leadId    String   @map("lead_id")
  html      String
  source    String   // "manual_save" | "pre_regenerate" | "pre_rebuild" | "ai_edit"
  version   Int
  createdAt DateTime @default(now()) @map("created_at")
  lead      Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId, version])
  @@map("site_versions")
}
